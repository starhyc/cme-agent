# 产品需求文档（PRD）- 用户注册功能示例

**版本**：v1.0
**创建时间**：2026-02-02
**项目类型**：0-1新项目

## 一、需求概述

本项目旨在为系统添加用户注册功能，解决当前系统无法识别和管理用户的问题。通过实现邮箱注册、密码验证、邮箱验证等功能，建立用户身份体系，为后续的用户管理和权限控制奠定基础。

**业务目标**：
- 允许用户自主注册账号
- 确保用户身份真实性（通过邮箱验证）
- 保护用户密码安全（加密存储）
- 防止恶意注册和重复注册

**成功标准**：
- 用户可以在3步内完成注册流程
- 注册成功率 > 95%（排除用户主动放弃）
- 邮箱验证率 > 80%（24小时内）
- 无密码明文存储的安全漏洞

**范围**：
- **包含**：邮箱注册、密码强度验证、邮箱验证、重复注册检测
- **不包含**：第三方登录（Google, GitHub）、手机号注册、多因素认证（后续版本考虑）

## 二、目标用户

**主要用户**：需要使用系统功能的个人用户

**用户画像**：
- 年龄：18-65岁
- 技术水平：基本的互联网使用能力
- 使用场景：首次访问系统时需要注册账号
- 用户期望：快速、简单、安全地完成注册

**使用场景**：
1. **场景1：新用户首次访问**
   - 用户访问系统首页
   - 点击"注册"按钮
   - 填写注册信息
   - 完成邮箱验证
   - 开始使用系统

2. **场景2：已有邮箱的用户尝试注册**
   - 用户尝试用已注册的邮箱注册
   - 系统提示邮箱已存在
   - 用户选择登录或找回密码

## 三、功能需求

### 功能1：用户注册
**功能描述**：
用户通过提供邮箱、密码和姓名完成账号注册。系统验证邮箱格式和密码强度，检查邮箱是否已被注册。注册成功后创建用户账号（状态为"未验证"），并发送验证邮件到用户邮箱。用户点击邮件中的验证链接后，账号状态变为"已验证"，可以正常登录使用系统。

**输入**：
- 邮箱地址（必填）：用户的邮箱地址，用于登录和接收验证邮件
- 密码（必填）：用户设置的登录密码，8-20位字符
- 姓名（必填）：用户的真实姓名或昵称，1-100字符

**输出**：
- **注册成功**：
  - 返回用户ID（UUID格式）
  - 返回用户基本信息（邮箱、姓名、创建时间）
  - 发送验证邮件到用户邮箱
  - 显示提示信息："注册成功！请查收验证邮件以激活账号"

- **注册失败**：
  - 返回错误码和错误信息
  - 显示具体的错误原因（邮箱已存在、格式错误、密码强度不足等）

**业务规则**：
1. 邮箱必须符合RFC 5322标准格式
2. 密码必须8-20位，包含至少一个大写字母、一个小写字母和一个数字
3. 姓名长度1-100字符，不允许特殊字符（仅允许中文、英文、数字、空格）
4. 同一邮箱只能注册一次
5. 密码使用bcrypt加密存储，不存储明文密码
6. 验证邮件链接有效期为24小时

**验收标准**：
- [ ] 用户访问注册页面，看到邮箱、密码、姓名三个输入框和"注册"按钮
- [ ] 用户输入有效邮箱（如test@example.com）、有效密码（如SecurePass123）、姓名（如张三）后点击注册按钮
- [ ] 系统验证邮箱格式正确（符合RFC 5322标准）
- [ ] 系统验证密码强度（至少8位，包含大小写字母和数字）
- [ ] 系统验证姓名长度在1-100字符之间
- [ ] 系统检查邮箱未被注册，若已存在则显示错误"该邮箱已被注册"
- [ ] 注册成功后系统创建用户记录，状态为"未验证"
- [ ] 系统向用户邮箱发送验证邮件，包含验证链接
- [ ] 验证邮件包含用户姓名、验证链接、链接有效期说明（24小时）
- [ ] 注册成功后页面显示"注册成功！请查收验证邮件以激活账号"
- [ ] 用户密码使用bcrypt加密存储，数据库中不存在明文密码

**错误场景**：
- [ ] 邮箱格式错误（如"invalid-email"）时，显示"请输入有效的邮箱地址"
- [ ] 邮箱为空时，显示"邮箱不能为空"
- [ ] 密码少于8位时，显示"密码长度至少为8位"
- [ ] 密码超过20位时，显示"密码长度不能超过20位"
- [ ] 密码不包含大写字母时，显示"密码必须包含至少一个大写字母"
- [ ] 密码不包含小写字母时，显示"密码必须包含至少一个小写字母"
- [ ] 密码不包含数字时，显示"密码必须包含至少一个数字"
- [ ] 姓名为空时，显示"姓名不能为空"
- [ ] 姓名超过100字符时，显示"姓名长度不能超过100字符"
- [ ] 邮箱已被注册时，显示"该邮箱已被注册，请直接登录或使用其他邮箱"
- [ ] 邮件服务不可用时，注册仍然成功，但显示"注册成功，但验证邮件发送失败，请联系客服"

### 功能2：邮箱验证
**功能描述**：
用户注册成功后收到验证邮件，点击邮件中的验证链接完成邮箱验证。验证链接包含加密的token，有效期为24小时。用户点击链接后，系统验证token有效性，将用户账号状态从"未验证"更新为"已验证"。验证成功后用户可以正常登录系统。

**输入**：
- 验证token（URL参数）：加密的验证令牌，包含用户ID和过期时间

**输出**：
- **验证成功**：
  - 更新用户状态为"已验证"
  - 显示"邮箱验证成功！您现在可以登录系统"
  - 提供"立即登录"按钮

- **验证失败**：
  - 显示具体的失败原因
  - 提供重新发送验证邮件的选项

**业务规则**：
1. 验证token使用JWT格式，包含用户ID和过期时间
2. Token有效期为24小时
3. Token只能使用一次，验证后立即失效
4. 已验证的用户不能重复验证

**验收标准**：
- [ ] 用户收到验证邮件，包含验证链接
- [ ] 用户点击验证链接，浏览器打开验证页面
- [ ] 系统解析URL中的token参数
- [ ] 系统验证token格式正确（JWT格式）
- [ ] 系统验证token未过期（24小时内）
- [ ] 系统验证token未被使用过
- [ ] 系统根据token中的用户ID查找用户
- [ ] 系统将用户状态从"未验证"更新为"已验证"
- [ ] 页面显示"邮箱验证成功！您现在可以登录系统"
- [ ] 页面提供"立即登录"按钮，点击跳转到登录页面

**错误场景**：
- [ ] Token格式错误时，显示"验证链接无效，请重新发送验证邮件"
- [ ] Token已过期（超过24小时）时，显示"验证链接已过期，请重新发送验证邮件"，并提供"重新发送"按钮
- [ ] Token已被使用时，显示"该验证链接已使用，如需重新验证请重新发送验证邮件"
- [ ] 用户不存在时，显示"用户不存在，请重新注册"
- [ ] 用户已验证时，显示"您的邮箱已验证，可以直接登录"，并提供"立即登录"按钮

### 功能3：重新发送验证邮件
**功能描述**：
未验证用户可以请求重新发送验证邮件。用户输入注册时使用的邮箱，系统检查该邮箱对应的账号状态，如果是"未验证"状态，则生成新的验证token并发送新的验证邮件。为防止滥用，同一邮箱在1分钟内只能请求一次。

**输入**：
- 邮箱地址（必填）：用户注册时使用的邮箱

**输出**：
- **发送成功**：显示"验证邮件已发送，请查收"
- **发送失败**：显示具体的失败原因

**业务规则**：
1. 只有"未验证"状态的用户可以重新发送
2. 同一邮箱1分钟内只能请求一次
3. 新token会使旧token失效
4. 新token有效期同样为24小时

**验收标准**：
- [ ] 用户访问"重新发送验证邮件"页面
- [ ] 用户输入邮箱地址后点击"发送"按钮
- [ ] 系统验证邮箱格式正确
- [ ] 系统查找该邮箱对应的用户
- [ ] 系统检查用户状态为"未验证"
- [ ] 系统检查距离上次发送时间超过1分钟
- [ ] 系统生成新的验证token
- [ ] 系统使旧token失效
- [ ] 系统发送新的验证邮件
- [ ] 页面显示"验证邮件已发送，请查收"

**错误场景**：
- [ ] 邮箱格式错误时，显示"请输入有效的邮箱地址"
- [ ] 邮箱不存在时，显示"该邮箱未注册"
- [ ] 用户已验证时，显示"您的邮箱已验证，无需重新发送"
- [ ] 距离上次发送不足1分钟时，显示"请求过于频繁，请1分钟后再试"
- [ ] 邮件服务不可用时，显示"验证邮件发送失败，请稍后重试或联系客服"

## 四、非功能需求

### 性能要求
- 注册接口响应时间 < 2秒（95%请求）
- 邮箱验证接口响应时间 < 1秒（95%请求）
- 系统支持并发100个注册请求
- 邮件发送队列处理延迟 < 5秒

### 安全要求
- 密码使用bcrypt加密，salt rounds = 10
- 验证token使用JWT，使用HS256算法签名
- 所有API使用HTTPS传输
- 实施CSRF保护
- 密码输入框使用type="password"，不显示明文
- 注册失败5次后显示验证码（防止暴力注册）

### 可用性要求
- 注册服务可用性 > 99.5%
- 邮件服务可用性 > 99%（使用第三方邮件服务）
- 数据库每日备份

### 用户体验要求
- 注册流程不超过3步
- 每个输入框都有清晰的标签和占位符
- 实时验证输入（失去焦点时验证）
- 错误提示清晰明确，告知用户如何修正
- 支持移动端响应式设计
- 密码输入框提供"显示/隐藏密码"切换按钮

### 兼容性要求
- 支持Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- 支持iOS 14+, Android 10+
- 支持屏幕宽度 320px - 2560px

## 五、优先级

### P0（必须）- MVP功能
- 用户注册（邮箱、密码、姓名）
- 密码强度验证
- 邮箱格式验证
- 重复注册检测
- 密码加密存储
- 邮箱验证（发送验证邮件、验证链接）

### P1（重要）- 第二阶段
- 重新发送验证邮件
- 注册频率限制（防止暴力注册）
- 验证码（注册失败5次后）
- 密码显示/隐藏切换
- 实时输入验证

### P2（可选）- 后续版本
- 第三方登录（Google, GitHub）
- 手机号注册
- 多因素认证
- 用户协议和隐私政策确认
- 注册来源追踪（用于分析）

## 附录

### 相关文档
- 用户登录功能PRD（待创建）
- 密码找回功能PRD（待创建）
- 用户资料管理PRD（待创建）

### 术语表
- **未验证用户**：已注册但未完成邮箱验证的用户，不能登录系统
- **已验证用户**：已完成邮箱验证的用户，可以正常登录使用系统
- **验证token**：用于验证用户邮箱的加密令牌，包含用户ID和过期时间
- **bcrypt**：密码加密算法，使用salt和多轮哈希确保安全性
- **JWT**：JSON Web Token，用于生成和验证token的标准格式

### 变更历史
| 版本 | 日期 | 变更内容 | 变更人 |
|------|------|----------|--------|
| v1.0 | 2026-02-02 | 初始版本 | PM |
